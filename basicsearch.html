<html>
 <head>
    <title>Nightly - Tables and Pricing</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

        <!-- jQueryMobileCSS - styling-->
        <link rel="stylesheet" href="css/jqeury.mobile.theme.min.css" />
        
        <!-- jQueryMobile icons -->
        <link rel="stylesheet" href="css/jquery.mobile.icons.min.css" />

        <!-- jQueryMobile core CSS -->
    <link rel="stylesheet" href="css/jquery.mobile.min.css" />
        
        <!-- NIGHTLY style -->
        <link rel="stylesheet" href="css/nightly.css" />

          <link rel="stylesheet" href="css/jquery.mobile.iscrollview.css" />
            <link rel="stylesheet" href="css/jquery.mobile.iscrollview-pull.css" />
        
        <!-- Load Google Fonts -->
        <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic,700italic' rel='stylesheet' type='text/css'>
        
        <!-- Load Font Awesome Icons -->
        <link rel="stylesheet" href="css/font-awesome.min.css">

    <!-- jQuery -->
        <script src="js/jquery.min.js"></script>
        
        <!-- jQueryMobile -->
        <script src="js/jquery.mobile.min.js"></script>
        
        <!-- NIGHTLY JS -->
        <script src="js/nightly.js"></script>

        <script src="js/iscroll.js"></script>
        <script src="js/jquery.mobile.iscrollview.js"></script>
        <style>
        .ui-content {
    padding: 0 !important;
}
 
.ui-listview {
    margin: 0 !important;
}
 
.example-wrapper, .example-wrapper div.iscroll-scroller {
    width: 100% !important;
}
</style>

    </head>

           <body>
    
        
   
                <div data-role="page" id="home">
                    <div data-theme="a" data-role="header">

                      <div data-role="panel" data-display="push" id="sidebar" data-theme="d">
                        <ul data-role="listview">
                            <li data-icon='home' class="ui-icon-alt"><a href="index.html">Home</a>
                            </li>
                            <hr>
                            <li data-icon='star'><a href="post.html">Make a Listing</a>
                            </li>
                            <hr>
                            <li data-icon='search'> <a href="search.html">View Listings</a>
                            </li>
                            </ul>
                     </div>

                     <form id="searchform1" data-theme="a" method="get">
                        <input data-role="none" role="form" class="nightly-input" type="text" id="search" name="search" placeholder="Search by book title or ISBN" />
                        <input data-role="none" class="nightly-button" type="submit" name="submit" value="" />
                    </form>
            
                    <div data-role="header" data-tap-toggle="false" data-theme='a'>
                        <a href='#sidebar'data-role="none"><img src="images/menu-icon.png" alt="sidebar" id="header-menu-icon" /></a>
                        <h1 class="header-title">Valotrade</h1>
                        <a href='#' data-role="none" id="a-search"><img src="images/search-icon.png" alt="search" id="header-search-icon" /></a>
                    </div>
                    

                        <h3>
                            Search Results
                        </h3>
                    </div>        
                    <div data-role="content">
                        <div class="example-wrapper" data-iscroll>
                            <ul data-role="listview"  id="post-list" data-theme="a">
                                
                            </ul>
                        </div>
                    </div>
                    
                </div>

                <div data-role="page" id="headline">
                    <div data-theme="a" data-role="header">
                        <a href="#home" class="ui-btn-left" data-transition="slide" data-direction="reverse">Back</a>                        
                        <h3>
                            Matches
                        </h3>
                    </div>        
                    <div data-role="content">
                        <ul data-role="listview"  id="post-data" data-theme="a">
                            
                        </ul>
                    </div>
                </div>  


 <script type="text/javascript">
 /*jQuery(document).ready(function($) {*/
$(document).on('pageinit', '#home', function(){ 

         $('#post-list').append('<li><a href="twitter.com" data-id=""' + '"H4H4H4H4"</li>' + '<br>'); 
        $('#post-list').listview('refresh'); 


    $('form').submit(function(e){
         console.log("made a search");
        e.preventDefault();
        makeAjaxRequest();
        return false;
    });

    function makeAjaxRequest() {
        //get result from server as JSON object
        $.ajax({
            url: 'http://107.170.157.210/ServerPHP/search.php',
            datatype: "jsonp",
            data: {search: $('input#search').val()},
            success: function(result) {

                //ajax.parseJSONP(result);
                console.log(result); 
                //$('table#resultTable tbody').html(response);
            },
             error: function (request,error) {
                alert('Network error has occurred please try again!');
            }
        });
    }; 
}); 



     $(document).on('pagebeforeshow', '#headline', function(){      
        $('#post-data').empty();
        $('#post-data').append('hello test'); 
        $.each(postInfo.result, function(i, row) {
            if(row.id == postInfo.id) {
                $('#post-data').append('<li>Title: '+row.Title+'</li>');        
                $('#post-data').listview('refresh');            
            }
        });    
    });

     $(document).on('vclick', '#post-list li a', function(){  
            postInfo.id = $(this).attr('data-id');
            $.mobile.changePage( "#headline", { transition: "slide", changeHash: false });
        });

     var postInfo = {
     id : null,
     result : null
    }


     var ajax = {  
        parseJSONP:function(result){  
                postInfo.result = result.results;
                $.each(result.results, function(i, row) {
                    console.log(JSON.stringify(row));
                    $('#post-list').append('<li><a href="" data-id="' + row.Id + '"><h3>' + row.Author + '</h3><p>' + row.Price + '/10</p></a></li>');
                });
                $('#post-list').listview('refresh');
            }
        }

   /* $.ajax({
        url: 'http://107.170.157.210/ServerPHP/search.php',
        type: 'get',
        data: {search: $('input#search').val()},
        success: function(response) {
            $('table#resultTable tbody').html(response);
        }
    });*/




</script>  
</body>  
</html>